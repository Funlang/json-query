!function(){function e(e,t,r){var n=r&&r.max||1/0,u=r&&r.includeDelimiters||!1,l=0,s=0,i=[],o=[];e.replace(/([\[\(\{])|([\]\)\}])/g,function(e,t,r,n){t?(0===l&&o.push([s,n]),l+=1):r&&0===(l-=1)&&(s=n+e.length)}),0===l&&s<e.length&&o.push([s,e.length]),s=0;for(var a=0;a<o.length&&n>0;a++)for(var c=o[a][0],f=t.exec(e.slice(c,o[a][1]));f&&n>1;c+=f.index+f[0].length,s=c,f=t.exec(e.slice(c,o[a][1])))i.push(e.slice(s,f.index+c)),u&&i.push(f[0]),n-=1;return s<e.length&&i.push(e.slice(s)),i}function t(e,t,n){e=e||{},this.handleQuery=n,this.options=e,this.locals=this.options.locals||{},this.globals=this.options.globals||{},this.rootContext=r(e.data,e.rootContext,e.context,e.source),this.parent=e.parent,this.override=e.override,this.filters=e.filters||{},this.params=t||e.params||[],this.context=r(e.currentItem,e.context,e.source),this.currentItem=r(this.context,e.rootContext,e.data),this.currentKey=null,this.currentReferences=[],this.currentParents=[]}function r(e){for(var t=0;t<arguments.length;t++)if(null!=arguments[t])return arguments[t]}function n(e){var t={};if(e)for(var r in e)r in e&&(t[r]=e[r]);return t}function u(t,r){if(!t)return[];var n,u=[],i=t.charAt(0),o=0,a=0,c=0,f=0,p=0,h="get",v=null;r&&(t=function(e){var t=0;return e.replace(/\?/g,function(e){return e+t++})}(t));var m={".":{mode:"get"},":":{mode:"filter"},"|":{handle:"or"},"[":{open:"select"},"]":{close:"select"},"{":{open:"meta"},"}":{close:"meta"},"(":{open:"args"},")":{close:"args"}};function g(e){v?v.push(e):u.push(e)}var d={get:function(e){var t="string"==typeof e?e.trim():null;t&&g({get:t})},select:function(t){if(t)g(function(t){if("*"===t)return{values:!0};if("**"===t)return{values:!0,deep:!0};var r=!1;"*"===t.charAt(0)&&(r=!0,t=t.slice(1));var n=e(t,/&|\|/,{includeDelimiters:!0});if(n.length>1){for(var u=[l(n[0].trim())],i=1;i<n.length;i+=2){var o=l(n[i+1].trim());o&&(o.booleanOp=n[i],u.push(o))}return{multiple:r,boolean:!0,select:u}}var u=l(t.trim());return u?(r&&(u.multiple=!0),u):{get:s(t.trim())}}(t));else{var r={deep:[]};u.push(r),v=r.deep}},filter:function(e){e&&g({filter:e.trim()})},or:function(){v=null,u.push({or:!0}),c=I+1},args:function(t){var r,n=","===(r=t)?[","]:e(r,/,/).map(function(e){return s(e.trim())});u[u.length-1].args=n}};function y(){var e=t.slice(o,a);d[h]&&d[h](e),h="get",o=a+1}for(var I=0;I<t.length;I++){n,n=i,i=t.charAt(I+1),0===(f=I-c)&&":"!==n&&"."!==n&&u.push({root:!0}),0===f&&"."===n&&"."===i&&u.push({parent:!0});var x=m[n];x&&(0===p&&(x.mode||x.open)&&(y(),h=x.mode||x.open),0===p&&x.handle&&(y(),d[x.handle]()),x.open?p+=1:x.close&&(p-=1),0===p&&x.close&&y()),a=I+1}return y(),u}function l(t){var r=e(t,/(!)?(=|~|\:|<=|>=|<|>)/,{max:2,includeDelimiters:!0});if(3===r.length){var n="!"===r[1].charAt(0),u=s(r[0].trim()),l={negate:n,op:n?r[1].slice(1):r[1]};if(":"===l.op)l.select=[u,{_sub:module.exports(":"+r[2].trim())}];else if("~"===l.op){var i=s(r[2].trim());if("string"==typeof i){var o=r[2].trim().match(/^\/(.*)\/([a-z]?)$/);l.select=o?[u,new RegExp(o[1],o[2])]:[u,i]}else l.select=[u,i]}else l.select=[u,s(r[2].trim())];return l}}function s(e){if("{"===(r=e).charAt(0)&&"}"===r.charAt(r.length-1)){var t=e.slice(1,-1);return{_sub:module.exports(t)}}return function(e){if("?"===e.charAt(0)){var t=parseInt(e.slice(1));return isNaN(t)?e:{_param:t}}return e}(e);var r}t.prototype={setCurrent:function(e,t){(this.currentItem||this.currentKey||this.currentParents.length>0)&&this.currentParents.push({key:this.currentKey,value:this.currentItem}),this.currentItem=t,this.currentKey=e},resetCurrent:function(){this.currentItem=null,this.currentKey=null,this.currentParents=[]},force:function(e){var t=this.currentParents[this.currentParents.length-1];return!this.currentItem&&t&&null!=this.currentKey&&(this.currentItem=e||{},t.value[this.currentKey]=this.currentItem),!!this.currentItem},getLocal:function(e){if(~e.indexOf("/")){for(var t=null,r=e.split("/"),n=0;n<r.length;n++){var u=r[n];0==n?t=this.locals[u]:t&&t[u]&&(t=t[u])}return t}return this.locals[e]},getGlobal:function(e){if(~e.indexOf("/")){for(var t=null,r=e.split("/"),n=0;n<r.length;n++){var u=r[n];0==n?t=this.globals[u]:t&&t[u]&&(t=t[u])}return t}return this.globals[e]},getFilter:function(e){if(~e.indexOf("/")){for(var t=null,r=e.split("/"),n=0;n<r.length;n++){var u=r[n];0==n?t=this.filters[u]:t&&t[u]&&(t=t[u])}return t}return this.filters[e]},addReferences:function(e){e&&e.forEach(this.addReference,this)},addReference:function(e){e instanceof Object&&!~this.currentReferences.indexOf(e)&&this.currentReferences.push(e)},getValues:function(e,t){return e.map(this.getValue,this)},getValue:function(e){return this.getValueFrom(e,null)},getValueFrom:function(e,t){if(null!=e._param)return this.params[e._param];if(e._sub){var r=n(this.options);r.force=null,r.currentItem=t;var u=this.handleQuery(e._sub,r,this.params);return this.addReferences(u.references),u.value}return e},deepQuery:function(e,t,r,u){Object.keys(e);for(var l in e)if(l in e){(r=n(this.options)).currentItem=e[l];var s=this.handleQuery(t,r,this.params);if(s.value)return s}return null}};var i={};function o(e,r,n){for(var u=new t(r,n,o),l=0;l<e.length&&!a(e[l],u);l++);if(a(null,u),u.currentItem instanceof Object)u.addReference(u.currentItem);else{var s=function(e){for(var t=0;t<e.length;t++)if(!(e[t+1]&&e[t+1].value instanceof Object))return e[t].value}(u.currentParents);s&&u.addReference(s)}return{value:u.currentItem,key:u.currentKey,references:u.currentReferences,parents:u.currentParents}}function a(e,t){if(null==e)!t.currentItem&&t.options.force&&t.force(t.options.force);else if(e.values)if(t.currentItem){var r=Object.keys(t.currentItem),n=[];r.forEach(function(r){e.deep&&Array.isArray(t.currentItem[r])?t.currentItem[r].forEach(function(e){n.push(e)}):n.push(t.currentItem[r])}),t.setCurrent(r,n)}else t.setCurrent(r,[]);else if(e.get){var u=t.getValue(e.get);if(function(e,t){return e.override&&e.currentItem===e.rootContext&&void 0!==e.override[t]}(t,u))t.setCurrent(u,t.override[u]);else if(t.currentItem||t.options.force&&t.force({}))if(function(e,t){return e instanceof Array&&parseInt(t)!=t}(t.currentItem,u)||e.multiple){n=t.currentItem.map(function(e){return e[u]}).filter(f);n=Array.prototype.concat.apply([],n),t.setCurrent(u,n)}else t.setCurrent(u,t.currentItem[u]);else t.setCurrent(u,null)}else if(e.select)if(Array.isArray(t.currentItem)||t.options.force&&t.force([])){var l=(e.boolean?e.select:[e]).map(function(e){if(":"===e.op){var r=t.getValue(e.select[0]);return{func:function(n){return r&&(n=n[r]),t.getValueFrom(e.select[1],n)},negate:e.negate,booleanOp:e.booleanOp}}var n=t.getValues(e.select);if(!t.options.allowRegexp&&"~"===e.op&&n[1]instanceof RegExp)throw new Error("options.allowRegexp is not enabled.");return{key:n[0],value:n[1],negate:e.negate,booleanOp:e.booleanOp,op:e.op}});if(e.multiple){r=[];var s=[];t.currentItem.forEach(function(e,t){c(e,l)&&(r.push(t),s.push(e))}),t.setCurrent(r,s)}else t.currentItem.some(function(e,r){if(c(e,l))return t.setCurrent(r,e),!0})||t.setCurrent(null,null)}else t.setCurrent(null,null);else if(e.root)t.resetCurrent(),e.args&&e.args.length?t.setCurrent(null,t.getValue(e.args[0])):t.setCurrent(null,t.rootContext);else if(e.parent)t.resetCurrent(),t.setCurrent(null,t.options.parent);else if(e.or){if(t.currentItem)return!0;t.resetCurrent(),t.setCurrent(null,t.context)}else if(e.filter){var i=t.getLocal(e.filter)||t.getGlobal(e.filter);if("function"==typeof i){n=t.getValues(e.args||[]);var o=i.apply(t.options,[t.currentItem].concat(n));t.setCurrent(null,o)}else{var a=t.getFilter(e.filter);if("function"==typeof a){n=t.getValues(e.args||[]),o=a.call(t.options,t.currentItem,{args:n,state:t,data:t.rootContext});t.setCurrent(null,o)}}}else if(e.deep)if(t.currentItem){if(0===e.deep.length)return;if(o=t.deepQuery(t.currentItem,e.deep,t.options)){t.setCurrent(o.key,o.value);for(var p=0;p<o.parents.length;p++)t.currentParents.push(o.parents[p])}else t.setCurrent(null,null)}else t.currentItem=null}function c(e,t){for(var r=!1,n=0;n<t.length;n++){var u=t[n],l=!1;u.func?l=u.func(e):"~"===u.op?l=u.value instanceof RegExp?e[u.key]&&!!e[u.key].match(u.value):e[u.key]&&!!~e[u.key].indexOf(u.value):"="===u.op?l=!0===e[u.key]&&"true"===u.value||!1===e[u.key]&&"false"===u.value||e[u.key]==u.value:">"===u.op?l=e[u.key]>u.value:"<"===u.op?l=e[u.key]<u.value:">="===u.op?l=e[u.key]>=u.value:"<="===u.op&&(l=e[u.key]<=u.value),u.negate&&(l=!l),r="&"===u.booleanOp?r&&l:"|"===u.booleanOp&&r||l}return r}function f(e){return void 0!==e}window.jsonQuery=function(e,t){var r=t&&t.params||null;return Array.isArray(e)&&(r=e.slice(1),e=e[0]),i[e]||(i[e]=u(e,!0)),o(i[e],t,r)},window.lastParent=function(e){var t=e.parents[e.parents.length-1];return t?t.value:null}}();
